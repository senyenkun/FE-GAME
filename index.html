<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FE ã‚¿ã‚¤ãƒ”ãƒ³ã‚°æ¼”ç¿’ - QUEST MODE</title>
    
    <!-- Tailwind CSS ã®èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts ã®èª­ã¿è¾¼ã¿ (Inter, Press Start 2P) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚©ãƒ³ãƒˆã¯Interã€ã‚¿ã‚¤ãƒˆãƒ«ã¯Press Start 2P */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1f2937 0%, #0f172a 100%); /* ãƒ€ãƒ¼ã‚¯ãªã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ */
            background-size: cover;
            background-attachment: fixed;
            color: #e2e8f0; /* å…¨ä½“çš„ãªæ–‡å­—è‰²ã‚’æ˜ã‚‹ã */
        }

        /* ã‚²ãƒ¼ãƒ ã®ã‚¿ã‚¤ãƒˆãƒ«ç”¨ãƒ•ã‚©ãƒ³ãƒˆ */
        .game-title-font {
            font-family: 'Press Start 2P', cursive;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        #app {
            background: rgba(30, 41, 59, 0.9); /* åŠé€æ˜ã®ãƒ€ãƒ¼ã‚¯ãƒ–ãƒ«ãƒ¼ */
            border: 2px solid #4a5568; /* æš—ã‚ã®ãƒœãƒ¼ãƒ€ãƒ¼ */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5); /* å¼·ã‚ã®å½± */
        }

        /* ã‚¹ã‚³ã‚¢ãƒ»ã‚¿ã‚¤ãƒãƒ¼ãƒ‘ãƒãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .game-panel {
            background: #1a202c; /* ãƒ€ãƒ¼ã‚¯ãªèƒŒæ™¯ */
            border: 1px solid #4a5568;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.4);
        }

        /* å•é¡Œè¡¨ç¤ºã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .question-display-area {
            background: #2d3748; /* ã‚„ã‚„æ˜ã‚‹ã‚ã®ãƒ€ãƒ¼ã‚¯ãƒ–ãƒ«ãƒ¼ */
            border: 2px solid #4a90e2; /* é’ã„ç™ºå…‰ãƒœãƒ¼ãƒ€ãƒ¼ */
            box-shadow: 0 0 15px rgba(74, 144, 226, 0.5); /* ç™ºå…‰åŠ¹æœ */
        }

        /* é¸æŠè‚¢/ãƒ’ãƒ³ãƒˆã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .options-hint-area {
            background: #1a202c;
            border: 1px solid #4a5568;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
            color: #a0aec0; /* è–„ã„ã‚°ãƒ¬ãƒ¼ã®æ–‡å­— */
        }

        /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #answer-input, #player-name-input {
            background: #1a202c;
            border: 2px solid #63b3ed; /* æ˜ã‚‹ã„é’ã®ãƒœãƒ¼ãƒ€ãƒ¼ */
            color: #e2e8f0;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        #answer-input:focus, #player-name-input:focus {
            border-color: #4a90e2; /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®è‰² */
            box-shadow: 0 0 10px rgba(74, 144, 226, 0.7); /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®ç™ºå…‰ */
            outline: none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’æ¶ˆã™ */
        }

        /* ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .game-button {
            background: linear-gradient(180deg, #4299e1 0%, #2b6cb0 100%); /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
            border-bottom: 3px solid #1c4b7b; /* ç«‹ä½“æ„Ÿã‚’å‡ºã™ãŸã‚ã®ä¸‹ã®ãƒœãƒ¼ãƒ€ãƒ¼ */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease-in-out;
        }
        .game-button:hover:not(:disabled) {
            transform: translateY(-2px); /* å°‘ã—æµ®ãä¸ŠãŒã‚‹ */
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.4);
            filter: brightness(1.1); /* å°‘ã—æ˜ã‚‹ã */
        }
        .game-button:active:not(:disabled) {
            transform: translateY(1px); /* æŠ¼ã—è¾¼ã‚“ã æ„Ÿã˜ */
            border-bottom: 1px solid #1c4b7b;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .game-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            filter: none;
        }
        
        /* ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .game-over-panel {
            background: #2d3748;
            border: 2px solid #f56565; /* èµ¤ã„è­¦æˆ’è‰² */
            box-shadow: 0 0 20px rgba(245, 101, 101, 0.7); /* èµ¤ã„ç™ºå…‰ */
            color: #e2e8f0;
        }

        /* æ­£è§£/ä¸æ­£è§£æ™‚ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .feedback-correct {
            color: #48bb78; /* ç·‘ */
            text-shadow: 0 0 8px rgba(72, 187, 120, 0.7);
        }
        .feedback-incorrect {
            color: #f56565; /* èµ¤ */
            text-shadow: 0 0 8px rgba(245, 101, 101, 0.7);
        }

        /* é¸æŠè‚¢ã‚’æµã‚Œã‚‹ã‚ˆã†ã«è¦‹ã›ã‚‹ãŸã‚ã®CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ (å‰å›ã®ç¶™æ‰¿) */
        @keyframes flow {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .question-flow {
            animation: flow 0.5s ease-out forwards;
        }

        /* ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒœãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .ranking-panel {
            background: #1a202c;
            border: 1px solid #4a90e2;
            box-shadow: 0 0 10px rgba(74, 144, 226, 0.3);
        }
        .rank-header {
            background: #2d3748;
        }
        .rank-item:nth-child(odd) {
            background: #1f2937;
        }
        .rank-item:nth-child(1) .rank-badge { color: #ffd700; } /* Gold */
        .rank-item:nth-child(2) .rank-badge { color: #c0c0c0; } /* Silver */
        .rank-item:nth-child(3) .rank-badge { color: #cd7f32; } /* Bronze */
        
        .player-info-panel {
            background: #1a202c;
            border: 1px solid #4a5568;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <!-- Firebaseã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦çµ±åˆ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firestoreã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’æœ‰åŠ¹åŒ–
        setLogLevel('Debug');

        // **********************************************
        // ğŸš¨ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæä¾›ã—ãŸFirebaseè¨­å®šæƒ…å ± (GitHub Pageså…¬é–‹ç”¨)
        // **********************************************
        const USER_FIREBASE_CONFIG = {
            apiKey: "AIzaSyByZlCvE4exyShtuzXnDl8rxQl5oWgVFQU",
            authDomain: "fegame-219e8.firebaseapp.com",
            projectId: "fegame-219e8",
            storageBucket: "fegame-219e8.firebasestorage.app",
            messagingSenderId: "202201690118",
            appId: "1:202201690118:web:0f6e43d66e3086acb09387",
            measurementId: "G-2BKS82EEKC"
        };
        // Canvasç’°å¢ƒã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ä½¿ç”¨ã—ã¤ã¤ã€GitHubå…¬é–‹æ™‚ã¯ä¸Šè¨˜è¨­å®šã‚’ä½¿ç”¨
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : USER_FIREBASE_CONFIG;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const appId = firebaseConfig.projectId || 'default-app-id'; // ProjectIdã‚’AppIdã¨ã—ã¦ä½¿ç”¨
        
        window.firebaseApp = null;
        window.auth = null;
        window.db = null;
        window.userId = null;
        
        const PLAYER_NAME_KEY = 'fe_quest_player_name';

        // --- Firebaseã‚µãƒ¼ãƒ“ã‚¹ã®åˆæœŸåŒ–ã¨èªè¨¼ ---
        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0 || !firebaseConfig.projectId) {
                    console.error("Firebase Config is incomplete or missing ProjectId. Database features will not work.");
                    document.getElementById('user-id-display').textContent = 'DB_ERROR';
                    return;
                }
                
                window.firebaseApp = initializeApp(firebaseConfig);
                window.auth = getAuth(window.firebaseApp);
                window.db = getFirestore(window.firebaseApp);

                onAuthStateChanged(window.auth, (user) => {
                    if (user) {
                        window.userId = user.uid;
                        document.getElementById('user-id-display').textContent = window.userId.substring(0, 6) + '...';
                        console.log("Firebase Auth Ready. User ID:", window.userId);
                        loadHighScores(); 
                    } else {
                        window.userId = null;
                        document.getElementById('user-id-display').textContent = 'N/A';
                        console.warn("User signed out or authentication failed.");
                    }
                });

                await setPersistence(window.auth, browserSessionPersistence);
                if (initialAuthToken) {
                    await signInWithCustomToken(window.auth, initialAuthToken);
                } else {
                    await signInAnonymously(window.auth);
                }
            } catch (error) {
                console.error("Firebase Initialization Error:", error);
            }
        }

        // --- Firestore ãƒ‡ãƒ¼ã‚¿æ“ä½œé–¢æ•° ---
        
        /**
         * ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã™ã‚‹
         */
        function saveScore(finalScore, genre, playerName) {
            if (!window.db || finalScore === 0 || !window.userId) {
                console.log("Database not ready, score is 0, or user not authenticated. Skipping save.");
                return;
            }

            try {
                const scoreData = {
                    score: finalScore,
                    genre: genre,
                    playerName: playerName || 'åç„¡ã—ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼', 
                    userId: window.userId, 
                    createdAt: serverTimestamp() 
                };

                // å…¬é–‹ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿å­˜
                const scoresCollection = collection(window.db, `artifacts/${appId}/public/data/highscores`);
                addDoc(scoresCollection, scoreData)
                    .then(() => console.log("Score saved successfully!"))
                    .catch(error => console.error("Error saving score:", error));
            } catch (error) {
                console.error("Error setting up score save:", error);
            }
        }

        /**
         * ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’èª­ã¿è¾¼ã¿ã€UIã‚’æ›´æ–°ã™ã‚‹
         */
        function loadHighScores() {
            if (!window.db) return;

            try {
                const scoresCollection = collection(window.db, `artifacts/${appId}/public/data/highscores`);
                // Firestoreã®orderByã‚’é¿ã‘ã‚‹ãŸã‚ã€å…¨ã¦å–å¾—ã—ã¦JSå´ã§ã‚½ãƒ¼ãƒˆ
                const q = query(scoresCollection); 

                onSnapshot(q, (snapshot) => {
                    const scores = [];
                    snapshot.forEach((doc) => {
                        scores.push({ id: doc.id, ...doc.data() });
                    });
                    
                    // ã‚¹ã‚³ã‚¢ãŒé«˜ã„é †ã€åŒç‚¹ã®å ´åˆã¯æ–°ã—ã„ã‚‚ã®é †ã«ã‚½ãƒ¼ãƒˆ
                    scores.sort((a, b) => {
                        if (b.score !== a.score) {
                            return b.score - a.score; 
                        }
                        const aTime = a.createdAt?.toMillis() || 0;
                        const bTime = b.createdAt?.toMillis() || 0;
                        return bTime - aTime;
                    });
                    
                    renderRanking(scores.slice(0, 10)); 
                }, error => console.error("Error in onSnapshot:", error));

            } catch (error) {
                console.error("Error loading high scores:", error);
            }
        }
        
        /**
         * ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’UIã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹
         */
        function renderRanking(topScores) {
            const rankingList = document.getElementById('ranking-list');
            rankingList.innerHTML = '';

            if (topScores.length === 0) {
                rankingList.innerHTML = '<p class="text-center p-4 text-gray-400">ã¾ã ã‚¹ã‚³ã‚¢ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã®æŒ‘æˆ¦è€…ã«ãªã‚Šã¾ã—ã‚‡ã†ï¼</p>';
                return;
            }

            topScores.forEach((scoreData, index) => {
                const rank = index + 1;
                const listItem = document.createElement('div');
                listItem.className = `rank-item flex justify-between items-center p-3 rounded-lg text-lg font-bold transition duration-150`;
                
                let rankBadge = `${rank}.`;
                if (rank <= 3) {
                    rankBadge = `â­ ${rank}`;
                }
                
                // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’YYYY/MM/DD HH:MMå½¢å¼ã«å¤‰æ›
                let timeStr = 'N/A';
                if (scoreData.createdAt && scoreData.createdAt.toDate) {
                    const date = scoreData.createdAt.toDate();
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    const hour = String(date.getHours()).padStart(2, '0');
                    const minute = String(date.getMinutes()).padStart(2, '0');
                    timeStr = `${year}/${month}/${day} ${hour}:${minute}`;
                }

                const displayName = scoreData.playerName || scoreData.userId?.substring(0, 6) + '...' || 'åç„¡ã—'; 

                listItem.innerHTML = `
                    <span class="rank-badge w-1/12 text-left">${rankBadge}</span>
                    <span class="text-blue-400 font-mono w-2/12 text-left">${scoreData.score} pts</span>
                    <span class="text-gray-300 w-2/12 text-left text-sm">${scoreData.genre}</span>
                    <span class="text-gray-500 w-4/12 text-center text-xs font-normal">${timeStr}</span>
                    <span class="text-yellow-400 w-3/12 text-right text-sm truncate" title="${displayName}">${displayName}</span>
                `;
                rankingList.appendChild(listItem);
            });
        }
        
        // **********************************************
        // ä»¥ä¸‹ã€ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã¨ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¸ã®å‰²ã‚Šå½“ã¦
        // **********************************************

        const TIME_LIMIT = 60; 
        const CORRECT_SCORE = 100; 
        const WRONG_PENALTY = 50; 

        let score = 0;
        let timer = TIME_LIMIT;
        let intervalId = null;
        let currentQuestionIndex = 0;
        let currentGenre = ''; 
        
        const questions = [
            // å½¢å¼: å•é¡Œæ–‡, æ­£è§£ã®èªå¥, é¸æŠè‚¢ (ã‚¿ã‚¤ãƒ”ãƒ³ã‚°å¯¾è±¡), ã‚¸ãƒ£ãƒ³ãƒ«
            // --- ãƒ†ã‚¯ãƒãƒ­ã‚¸ç³» ---
            ["ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®è¦æ±‚ã«å¿œã˜ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚„ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ã“ã¨ã€‚", "ã‚µãƒ¼ãƒ", "A: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ / B: ã‚µãƒ¼ãƒ / C: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«", "ãƒ†ã‚¯ãƒãƒ­ã‚¸ç³»"],
            ["Webãƒšãƒ¼ã‚¸ã‚’é–²è¦§ã™ã‚‹ãŸã‚ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã€‚ãƒ‡ãƒ¼ã‚¿ã®è¦æ±‚ã¨è¡¨ç¤ºã‚’è¡Œã†ã€‚", "ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶", "A: Webã‚µãƒ¼ãƒ / B: Webãƒ–ãƒ©ã‚¦ã‚¶ / C: HTML", "ãƒ†ã‚¯ãƒãƒ­ã‚¸ç³»"],
            ["ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œé€Ÿåº¦ã‚’é«˜é€ŸåŒ–ã™ã‚‹ãŸã‚ã«ã€ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã‚ˆã‚Šã‚‚é«˜é€Ÿãªå°å‹ãƒ¡ãƒ¢ãƒªã€‚", "ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒª", "A: ä¸»è¨˜æ†¶è£…ç½® / B: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒª / C: ãƒ¬ã‚¸ã‚¹ã‚¿", "ãƒ†ã‚¯ãƒãƒ­ã‚¸ç³»"],
            ["å¤–éƒ¨ã‹ã‚‰ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²ããŸã‚ã«ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å¢ƒç•Œã«è¨­ç½®ã•ã‚Œã‚‹ã‚·ã‚¹ãƒ†ãƒ ã€‚", "ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«", "A: ãƒ«ãƒ¼ã‚¿ / B: ã‚¹ã‚¤ãƒƒãƒ / C: ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«", "ãƒ†ã‚¯ãƒãƒ­ã‚¸ç³»"],
            ["ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒè¡Œã†è¨ˆç®—å‡¦ç†ã®æ‰‹é †ã‚’è¨˜è¿°ã—ãŸã‚‚ã®ã€‚", "ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ", "A: ãƒ‡ãƒ¼ã‚¿æ§‹é€  / B: ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  / C: æ§‹æ–‡", "ãƒ†ã‚¯ãƒãƒ­ã‚¸ç³»"],
            ["ç‰¹å®šã®åˆ©ç”¨è€…ã ã‘ãŒæƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹çŠ¶æ…‹ã‚’ä¿ã¤ã“ã¨ã€‚", "æ©Ÿå¯†æ€§", "A: æ©Ÿå¯†æ€§ / B: æ•´åˆæ€§ / C: å¯ç”¨æ€§", "ãƒ†ã‚¯ãƒãƒ­ã‚¸ç³»"],
            ["ä¼æ¥­ã®æ©Ÿå¯†æƒ…å ±ã‚’ç›—ã¿å‡ºã™ã“ã¨ã‚’ç›®çš„ã¨ã—ãŸã‚µã‚¤ãƒãƒ¼æ”»æ’ƒã€‚", "æ¨™çš„å‹æ”»æ’ƒ", "A: ãƒãƒ«ã‚¦ã‚§ã‚¢ / B: æ¨™çš„å‹æ”»æ’ƒ / C: ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°", "ãƒ†ã‚¯ãƒãƒ­ã‚¸ç³»"],
            
            // --- ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆç³» ---
            ["ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãŠã„ã¦ã€ãƒ‡ãƒ¼ã‚¿ã®é‡è¤‡ã‚„çŸ›ç›¾ãŒãªãã€ä¸€è²«æ€§ãŒä¿ãŸã‚Œã¦ã„ã‚‹ã“ã¨ã€‚", "æ•´åˆæ€§", "A: æ©Ÿå¯†æ€§ / B: æ•´åˆæ€§ / C: å¯ç”¨æ€§", "ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆç³»"],
            ["ã‚·ã‚¹ãƒ†ãƒ ã®ä¼ç”»ã‹ã‚‰é–‹ç™ºã€é‹ç”¨ã€ä¿å®ˆã¾ã§ã®ä¸€é€£ã®æµã‚Œã€‚", "ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«", "A: SDLC / B: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚µã‚¤ã‚¯ãƒ« / C: é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹", "ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆç³»"],
            ["ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®æ¨™ã‚’é”æˆã™ã‚‹ãŸã‚ã«ã€è¨ˆç”»ã€å®Ÿè¡Œã€ç›£è¦–ã€çµ‚çµã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã€‚", "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ", "A: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ / B: ãƒªã‚¹ã‚¯ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ / C: å“è³ªãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ", "ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆç³»"],
            ["ã‚·ã‚¹ãƒ†ãƒ ã®æ©Ÿèƒ½ã‚„æ€§èƒ½ã«é–¢ã™ã‚‹è¦æ±‚äº‹é …ã‚’æ˜ç¢ºã«ã™ã‚‹å·¥ç¨‹ã€‚", "è¦ä»¶å®šç¾©", "A: å¤–éƒ¨è¨­è¨ˆ / B: å†…éƒ¨è¨­è¨ˆ / C: è¦ä»¶å®šç¾©", "ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆç³»"],
            
            // --- ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ç³» ---
            ["ä¼æ¥­å…¨ä½“ã®æƒ…å ±æˆ¦ç•¥ã«é–¢ã™ã‚‹æ„æ€æ±ºå®šã‚’è¡Œã†çµ„ç¹”ã‚„å½¹è·ã€‚", "CIO", "A: CEO / B: COO / C: CIO", "ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ç³»"],
            ["ä¼æ¥­ã®äº‹æ¥­æ´»å‹•å…¨ä½“ã‚’ã€é¡§å®¢ã¸ã®ä¾¡å€¤æä¾›ã¨ã„ã†è¦–ç‚¹ã‹ã‚‰åˆ†æã™ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚", "ãƒãƒªãƒ¥ãƒ¼ãƒã‚§ãƒ¼ãƒ³", "A: SWOTåˆ†æ / B: ãƒãƒªãƒ¥ãƒ¼ãƒã‚§ãƒ¼ãƒ³ / C: PESTåˆ†æ", "ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ç³»"],
            ["ä¼æ¥­ã®æŒã¤çµŒå–¶è³‡æºï¼ˆãƒ’ãƒˆã€ãƒ¢ãƒã€ã‚«ãƒã€æƒ…å ±ï¼‰ã‚’åŠ¹ç‡çš„ã«æ´»ç”¨ã™ã‚‹ãŸã‚ã®æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ ã€‚", "ERP", "A: CRM / B: SCM / C: ERP", "ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ç³»"],
            ["è‡ªç¤¾ã®å¼·ã¿ã¨å¼±ã¿ã€å¤–éƒ¨ç’°å¢ƒã®æ©Ÿä¼šã¨è„…å¨ã‚’åˆ†æã—ã€æˆ¦ç•¥ã‚’ç«‹ã¦ã‚‹æ‰‹æ³•ã€‚", "SWOTåˆ†æ", "A: ãƒãƒªãƒ¥ãƒ¼ãƒã‚§ãƒ¼ãƒ³ / B: SWOTåˆ†æ / C: PESTåˆ†æ", "ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ç³»"],
        ];
        
        let availableQuestions = []; 

        // --- UIè¦ç´ ã®å–å¾— ---
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');
        const timerPanel = document.getElementById('timer-panel');
        const scoreTimerArea = document.getElementById('score-timer-area');
        const questionTextElement = document.getElementById('question-text');
        const optionsAreaElement = document.getElementById('options-area');
        const answerInput = document.getElementById('answer-input');
        const submitButton = document.getElementById('submit-button');
        const feedbackMessage = document.getElementById('feedback-message');
        const gameOverScreen = document.getElementById('game-over-screen');
        const gameArea = document.getElementById('game-area');
        const finalScoreElement = document.getElementById('final-score');
        const genreDisplay = document.getElementById('genre-display');
        const genreSelectionScreen = document.getElementById('genre-selection-screen');

        // ******************** ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡é–¢æ•° ********************

        /**
         * ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã—ã€ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ (HTMLã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½)
         */
        window.showGenreSelection = function() {
            // å…¨ã¦ã®ç”»é¢ã‚’éè¡¨ç¤º
            gameArea.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            scoreTimerArea.classList.add('hidden');
            
            // ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠç”»é¢ã‚’è¡¨ç¤º
            genreSelectionScreen.classList.remove('hidden');
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒ¼ãƒ ã‚’èª­ã¿è¾¼ã¿ã€è¡¨ç¤ºã‚’æ›´æ–°
            window.loadPlayerName();

            // ã‚¿ã‚¤ãƒãƒ¼ãŒå‹•ã„ã¦ã„ãŸã‚‰åœæ­¢
            if (intervalId) clearInterval(intervalId);
            
            // å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆã‚’è§£é™¤
            answerInput.removeEventListener('keypress', handleKeyPress);
        }
        
        /**
         * é¸æŠã•ã‚ŒãŸã‚¸ãƒ£ãƒ³ãƒ«ã®å•é¡Œã§ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹ (HTMLã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½)
         */
        window.startGenreQuiz = function(selectedGenre) {
            currentGenre = selectedGenre;

            // UIã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            score = 0;
            timer = TIME_LIMIT;
            currentQuestionIndex = 0;
            updateUI();
            feedbackMessage.textContent = '';

            // ç”»é¢è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
            genreSelectionScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            gameArea.classList.remove('hidden');
            scoreTimerArea.classList.remove('hidden');

            // å•é¡Œã‚’ã‚¸ãƒ£ãƒ³ãƒ«ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            if (selectedGenre === 'ã‚ªãƒ¼ãƒ«ã‚¨ãƒªã‚¢') {
                availableQuestions = [...questions].sort(() => Math.random() - 0.5);
            } else {
                availableQuestions = questions
                    .filter(q => q[3] === selectedGenre)
                    .sort(() => Math.random() - 0.5);
            }

            if (availableQuestions.length === 0) {
                questionTextElement.textContent = `ã‚¨ãƒ©ãƒ¼: ${selectedGenre} ã®å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚`;
                return;
            }

            // ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ–
            answerInput.value = '';
            answerInput.disabled = false;
            submitButton.disabled = false;
            answerInput.focus();
            
            // ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹
            if (intervalId) clearInterval(intervalId);
            intervalId = setInterval(tick, 1000);

            displayNextQuestion();
            
            answerInput.addEventListener('keypress', handleKeyPress);
        }

        /**
         * 1ç§’ã”ã¨ã«ã‚¿ã‚¤ãƒãƒ¼ã‚’æ›´æ–°ã™ã‚‹
         */
        function tick() {
            timer--;
            timerElement.textContent = timer;

            if (timer <= 10) {
                timerPanel.classList.remove('text-red-300');
                timerPanel.classList.add('bg-red-700', 'text-white', 'animate-pulse');
            } else {
                timerPanel.classList.remove('bg-red-700', 'text-white', 'animate-pulse');
                timerPanel.classList.add('text-red-300');
            }

            if (timer <= 0) {
                endGame();
            }
        }

        /**
         * ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†ã™ã‚‹
         */
        function endGame() {
            clearInterval(intervalId);
            answerInput.removeEventListener('keypress', handleKeyPress);

            answerInput.disabled = true;
            submitButton.disabled = true;

            gameArea.classList.add('hidden');
            scoreTimerArea.classList.add('hidden');
            gameOverScreen.classList.remove('hidden');
            
            const playerName = localStorage.getItem(PLAYER_NAME_KEY) || 'åç„¡ã—ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼';

            // ã‚¹ã‚³ã‚¢ã‚’ä¿å­˜
            saveScore(score, currentGenre, playerName);

            finalScoreElement.textContent = score;
            const gameOverTitle = document.querySelector('#game-over-screen h2');
            if (score > 0) {
                gameOverTitle.textContent = 'MISSION COMPLETE!';
            } else {
                gameOverTitle.textContent = 'MISSION FAILED!';
            }
        }

        /**
         * æ¬¡ã®å•é¡Œã‚’è¡¨ç¤ºã™ã‚‹
         */
        function displayNextQuestion() {
            if (currentQuestionIndex >= availableQuestions.length) {
                timer = 0; 
                endGame();
                return;
            }

            const q = availableQuestions[currentQuestionIndex];
            
            questionTextElement.classList.remove('question-flow');
            optionsAreaElement.classList.remove('question-flow');

            questionTextElement.textContent = q[0];
            optionsAreaElement.textContent = q[2];
            genreDisplay.textContent = q[3]; 
            
            setTimeout(() => {
                questionTextElement.classList.add('question-flow');
                optionsAreaElement.classList.add('question-flow');
            }, 10); 

            answerInput.value = '';
            feedbackMessage.textContent = '';
            answerInput.focus();
        }

        /**
         * è§£ç­”ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ (HTMLã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½)
         */
        window.checkAnswer = function() {
            if (currentQuestionIndex >= availableQuestions.length || answerInput.disabled) return;

            const q = availableQuestions[currentQuestionIndex];
            const correctAnswer = q[1];
            const userAnswer = answerInput.value;

            // ï¼ï¼ï¼æ­£è¦åŒ–å‡¦ç†ã®é©ç”¨ï¼ï¼ï¼
            const normalizedCorrect = normalizeJapanese(correctAnswer);
            const normalizedUser = normalizeJapanese(userAnswer);

            if (normalizedUser === normalizedCorrect) {
                score += CORRECT_SCORE;
                feedbackMessage.textContent = 'ğŸ‰ CORRECT! KNOWLEDGE GAINED!';
                feedbackMessage.className = 'text-center font-bold text-xl feedback-correct';
            } else {
                score -= WRONG_PENALTY;
                if (score < 0) score = 0; 
                feedbackMessage.textContent = `âŒ INCORRECT! The answer was "${correctAnswer}".`;
                feedbackMessage.className = 'text-center font-bold text-xl feedback-incorrect';
            }

            updateUI();
            
            currentQuestionIndex++;
            setTimeout(displayNextQuestion, 1500); 
        }
        
        /**
         * ã‚¹ã‚³ã‚¢ã¨ã‚¿ã‚¤ãƒãƒ¼ã®è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹
         */
        function updateUI() {
            scoreElement.textContent = score;
            timerElement.textContent = timer;
        }

        /**
         * Enterã‚­ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
         */
        function handleKeyPress(e) {
            if (e.key === 'Enter') {
                e.preventDefault(); 
                checkAnswer();
            }
        }

        /**
         * ã‚¹ã‚³ã‚¢ã‚’Twitter (X) ã§å…±æœ‰ã™ã‚‹ (HTMLã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½)
         */
        window.shareScore = function() {
            const finalScore = score;
            const genreText = currentGenre === 'ã‚ªãƒ¼ãƒ«ã‚¨ãƒªã‚¢' ? 'å…¨ç¯„å›²' : currentGenre;
            const playerName = localStorage.getItem(PLAYER_NAME_KEY) || 'åç„¡ã—ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼';
            
            const text = `ğŸ† ${playerName}ãŒFE QUEST ${genreText}ãƒ¢ãƒ¼ãƒ‰ã§ã‚¹ã‚³ã‚¢${finalScore}ç‚¹ã‚’ç²å¾—ã—ã¾ã—ãŸï¼\n\nåŸºæœ¬æƒ…å ±æŠ€è¡“è€…è©¦é¨“ã®çŸ¥è­˜å®šç€ã«åŠ¹æœçš„ãªã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¯ã‚¤ã‚ºã«æŒ‘æˆ¦ã—ã‚ˆã†ï¼\n`;
            
            const url = encodeURIComponent(window.location.href); 
            const hashtags = 'åŸºæœ¬æƒ…å ±æŠ€è¡“è€…è©¦é¨“,FE,ITè³‡æ ¼,ã‚¿ã‚¤ãƒ”ãƒ³ã‚°å­¦ç¿’';

            const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${url}&hashtags=${hashtags}`;
            
            window.open(shareUrl, '_blank');
        }
        
        /**
         * æ—¥æœ¬èªã®è¡¨è¨˜æºã‚Œã‚’å¸åã™ã‚‹ãŸã‚ã®æ­£è¦åŒ–å‡¦ç†
         */
        function normalizeJapanese(str) {
            if (!str) return '';
            
            let normalized = str.trim().toLowerCase();
            
            normalized = normalized.replace(/[\u3041-\u3096]/g, function(match) {
                return String.fromCharCode(match.charCodeAt(0) + 0x60);
            });

            normalized = normalized.replace(/[ï¼-ï½]/g, function(match) {
                return String.fromCharCode(match.charCodeAt(0) - 0xFEE0);
            });
            
            normalized = normalized.replace(/\s/g, '');

            return normalized;
        }

        // --- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒ¼ãƒ ç®¡ç†é–¢æ•° ---

        /**
         * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒ¼ãƒ ã‚’LocalStorageã‹ã‚‰ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ (HTMLã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½)
         */
        window.loadPlayerName = function() { 
            const savedName = localStorage.getItem(PLAYER_NAME_KEY);
            const input = document.getElementById('player-name-input');
            const display = document.getElementById('player-name-display');

            const defaultName = 'åç„¡ã—ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼';
            const nameToUse = savedName || defaultName;
            
            input.value = nameToUse;
            display.textContent = nameToUse;
        };

        /**
         * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒ¼ãƒ ã‚’LocalStorageã«ä¿å­˜ã™ã‚‹ (HTMLã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½)
         */
        window.savePlayerName = function() {
            const input = document.getElementById('player-name-input');
            const newName = input.value.trim();
            
            if (newName && newName.length <= 20) {
                localStorage.setItem(PLAYER_NAME_KEY, newName);
                document.getElementById('player-name-display').textContent = newName;
                console.log("Player name saved:", newName);
            } else {
                console.error("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒ¼ãƒ ã¯1æ–‡å­—ä»¥ä¸Š20æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"); 
            }
        }

        // ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®å‡¦ç†
        initializeFirebase();
        window.onload = function() {
            showGenreSelection(); // ç”»é¢ã®åˆæœŸè¡¨ç¤º
        };
    </script>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="app" class="rounded-2xl w-full max-w-lg p-8 space-y-6">

        <h1 class="text-4xl font-extrabold text-center text-blue-400 pb-2 game-title-font">
            FE QUEST
        </h1>
        <p class="text-md text-center text-blue-200 mt-0">ITçŸ¥è­˜ã€ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã§GETã ãœï¼</p>
        
        <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒ¼ãƒ è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div class="player-info-panel p-3 rounded-lg text-sm text-gray-400 font-mono flex justify-between items-center">
            <span>CHALLENGER: <span id="player-name-display" class="text-yellow-300 font-bold">åç„¡ã—ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼</span></span>
            <!-- å†…éƒ¨ç®¡ç†ç”¨IDã¯éè¡¨ç¤ºã¾ãŸã¯ç›®ç«‹ãŸãªã„ã‚ˆã†ã« -->
            <span class="text-xs text-gray-600">ID: <span id="user-id-display">...</span></span>
        </div>

        <!-- ã‚¹ã‚³ã‚¢ã¨ã‚¿ã‚¤ãƒãƒ¼ã®è¡¨ç¤ºã‚¨ãƒªã‚¢ (ã‚²ãƒ¼ãƒ è¦ç´ ) -->
        <!-- åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º -->
        <div id="score-timer-area" class="flex justify-between text-xl font-mono hidden">
            <div class="game-panel text-blue-200 p-3 rounded-lg flex-1 mr-2 text-center">
                SCORE: <span id="score">0</span>
            </div>
            <div class="game-panel text-red-300 p-3 rounded-lg flex-1 ml-2 text-center" id="timer-panel">
                TIME: <span id="timer">60</span>s
            </div>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚¨ãƒªã‚¢ (åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º) -->
        <div id="game-area" class="space-y-5 hidden">
            
            <!-- å•é¡Œè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="question-display-area p-5 rounded-xl text-center space-y-2">
                <p class="text-sm font-semibold text-blue-300 mb-1">
                    <span class="text-yellow-300 mr-2">AREA:</span> <span id="genre-display">ã‚¸ãƒ£ãƒ³ãƒ«</span>
                </p>
                <p class="text-lg font-bold text-gray-100 leading-relaxed" id="question-text">
                    [Press START to Begin Your Quest!]
                </p>
            </div>

            <!-- é¸æŠè‚¢ã¨ã‚¿ã‚¤ãƒ”ãƒ³ã‚°å…¥åŠ›ã‚¨ãƒªã‚¢ -->
            <div id="quiz-content" class="space-y-4">
                
                <!-- é¸æŠè‚¢ (ãƒ’ãƒ³ãƒˆ) -->
                <div class="options-hint-area p-4 rounded-lg text-lg font-mono question-flow">
                    <p class="text-sm text-gray-400 mb-2">HINT: Choose wisely!</p>
                    <div id="options-area" class="text-gray-200">
                        A: ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« / B: ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒ / C: ãƒ«ãƒ¼ã‚¿
                    </div>
                </div>

                <!-- ã‚¿ã‚¤ãƒ”ãƒ³ã‚°å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
                <input type="text" id="answer-input" placeholder="Type your answer here..." 
                       class="w-full p-4 rounded-lg text-lg focus:outline-none transition duration-150" disabled>
                
                <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                <p id="feedback-message" class="text-center font-bold h-6 text-xl"></p>

                <!-- è§£ç­”ãƒœã‚¿ãƒ³ -->
                <button id="submit-button" onclick="checkAnswer()" disabled
                        class="game-button text-white font-bold py-3 px-4 rounded-lg w-full text-xl disabled:opacity-50">
                    SUBMIT (Enter)
                </button>
            </div>
        </div>
        
        <!-- ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠç”»é¢ (ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒœãƒ¼ãƒ‰ã‚‚å«ã‚€) -->
        <div id="genre-selection-screen" class="space-y-6 hidden">
            
            <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒ¼ãƒ è¨­å®šã‚¨ãƒªã‚¢ -->
            <div class="space-y-2 player-info-panel p-4 rounded-xl">
                <label for="player-name-input" class="text-sm font-semibold text-yellow-300">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒ¼ãƒ è¨­å®š (20æ–‡å­—ã¾ã§)</label>
                <div class="flex space-x-2">
                    <input type="text" id="player-name-input" placeholder="ã‚ãªãŸã®æŒ‘æˆ¦è€…åã‚’å…¥åŠ›" maxlength="20"
                           class="w-full p-2 rounded-lg text-sm focus:outline-none">
                    <!-- ä¿å­˜ãƒœã‚¿ãƒ³ã¯ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã®Enterã‚­ãƒ¼ã¨ç«¶åˆã—ãªã„ã‚ˆã†ã€åˆ¥é€”ã‚¯ãƒªãƒƒã‚¯ã§å®Ÿè¡Œ -->
                    <button onclick="savePlayerName()" class="game-button py-2 px-4 rounded-lg text-sm whitespace-nowrap">
                        SAVE
                    </button>
                </div>
            </div>

            <h2 class="text-2xl font-extrabold text-center text-blue-300 border-b border-blue-500 pb-2">SELECT YOUR AREA</h2>
            <div class="grid grid-cols-1 gap-4">
                <button onclick="startGenreQuiz('ãƒ†ã‚¯ãƒãƒ­ã‚¸ç³»')" class="game-button py-4 text-xl hover:bg-blue-600">
                    ãƒ†ã‚¯ãƒãƒ­ã‚¸ç³» (Tech)
                </button>
                <button onclick="startGenreQuiz('ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆç³»')" class="game-button py-4 text-xl hover:bg-green-700" 
                        style="background: linear-gradient(180deg, #48bb78 0%, #38a169 100%); border-bottom: 3px solid #276749;">
                    ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆç³» (Management)
                </button>
                <button onclick="startGenreQuiz('ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ç³»')" class="game-button py-4 text-xl hover:bg-orange-600" 
                        style="background: linear-gradient(180deg, #ed8936 0%, #dd6b20 100%); border-bottom: 3px solid #9c4221;">
                    ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ç³» (Strategy)
                </button>
                <button onclick="startGenreQuiz('ã‚ªãƒ¼ãƒ«ã‚¨ãƒªã‚¢')" class="game-button py-4 text-xl hover:bg-purple-600" 
                        style="background: linear-gradient(180deg, #a78bfa 0%, #7c3aed 100%); border-bottom: 3px solid #5b21b6;">
                    ã‚ªãƒ¼ãƒ«ã‚¨ãƒªã‚¢ (ALL AREA)
                </button>
            </div>

            <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒœãƒ¼ãƒ‰ -->
            <div class="ranking-panel rounded-xl mt-8">
                <h3 class="rank-header text-xl font-extrabold text-yellow-300 text-center py-3 rounded-t-xl">
                    ğŸ† HIGH SCORE QUEST RANKING ğŸ†
                </h3>
                <div class="flex justify-between font-mono text-sm text-gray-400 p-2 border-b border-gray-700">
                    <span class="w-1/12 text-left">RANK</span>
                    <span class="w-2/12 text-left">SCORE</span>
                    <span class="w-2/12 text-left">AREA</span>
                    <span class="w-4/12 text-center">TIME</span>
                    <span class="w-3/12 text-right">PLAYER</span>
                </div>
                <div id="ranking-list" class="space-y-1 p-2">
                    <p class="text-center p-4 text-gray-400">Loading Scores...</p>
                </div>
            </div>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ (åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º) -->
        <div id="game-over-screen" class="hidden text-center p-8 game-over-panel rounded-xl space-y-4">
            <h2 class="text-4xl font-extrabold text-red-400 game-title-font">MISSION COMPLETE!</h2>
            <p class="text-2xl text-gray-200">FINAL SCORE: <span id="final-score" class="text-red-300 text-4xl font-bold game-title-font">0</span></p>
            <p class="text-md text-gray-400">Score has been recorded to the global ranking!</p>
            
            <button id="share-score-button" onclick="shareScore()"
                    class="game-button py-3 px-4 rounded-lg w-full text-xl mt-4"
                    style="background: linear-gradient(180deg, #00acee 0%, #0084b4 100%); border-bottom: 3px solid #005f7e;">
                ğŸ† ã‚¹ã‚³ã‚¢ã‚’ã‚·ã‚§ã‚¢ã™ã‚‹ (X)
            </button>

            <button id="return-to-select-button" onclick="showGenreSelection()"
                    class="game-button bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg w-full text-xl mt-4"
                    style="background: linear-gradient(180deg, #48bb78 0%, #38a169 100%); border-bottom: 3px solid #276749;">
                SELECT NEW AREA
            </button>
        </div>

    </div>
</body>
</html>
